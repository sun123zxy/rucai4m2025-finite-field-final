## Introduction

We proved and formalized some exercises in Lean 4 from the book:

- Lidl, Rudolf, and Harald Niederreiter. Finite fields. No. 20. Cambridge university press, 1997.

The exercises are:

- **Exercise 2.10**: If the group of units $F^\times$ of a field $F$ is cyclic, then $F$ is finite.

  A comprehensive formalization with 300+ lines of code.

- **Exercise 3.30**: Show that $\sum_{d \mid n} \frac{\phi(d)}{d} = \frac{\phi(n)}{n}$.

  Packed Euler's totient function into an Arithmetic function.

- **Exercise 2.15**: Every element of $\mathbb F_q$ is the $k$-th power of some element of $\mathbb F_q$
if and only if $\gcd (q - 1, k) = 1$.

## Plan for Exercise 2.10

### Supporting Lemmas

- **`finite_of_finite_units`**: If the group of units $F^\times$ of a field $F$ is finite, then $F$ is finite. 
  - Proof: $F = F^\times \cup \{0\}$

- **`orderOf_eq_zero_of_cyclic_of_infinite`**: If $G$ is an infinite cyclic group, then every non-identity element has order 0.
  - This is because $G \cong (\mathbb{Z}, +)$, and in $\mathbb{Z}$ every non-zero element is of order zero.

- **`simple_extension_of_cyclic_generator`**: If $E/F$ is a field extension and the unit group $E^\times$ is generated by a single element $g$, then $E = F[g]$.

### Main Logic

- **`finite_of_char_two_of_cyclic_units`**: If $F$ is a field of characteristic $2$ with cyclic unit group $F^\times$, then $F$ is finite.
  - Say $F^\times$ is generated by $g$
  - Then $g$ is algebraic over $\mathbb{F}_2$ (since $1 + g$ must be a power of $g$)
  - Then $F = \mathbb{F}_2[g]$ is a finite extension of $\mathbb{F}_2$
  - Therefore $F$ is finite

- **`finite_of_cyclic_units`**: If $F$ is a field with cyclic unit group $F^\times$, then $F$ is finite.

  - Assume $F$ is infinite
  - Then $F^\times$ is infinite (since $F = F^\times \cup \{0\}$)
  - Then all non-identity elements of $F^\times$ have order 0 (by `orderOf_eq_zero_of_cyclic_of_infinite`)
  - But $-1 \in F^\times$ has order $2$ unless $\mathrm{char} F = 2$
  - Therefore $\mathrm{char} F = 2$
  - Then $F$ is finite by `finite_of_char_two_of_cyclic_units`
  - Contradiction!

## Afterwords

1. Formalization itself sucks, but it leads to a better structure of the proof.

2. Cumbersome type coercions and casts. e.g.

  ```lean
  variable (G : Type) [Group G]
  example (g : G) (hg : ∃ n : ℤ, n > 0 ∧ g ^ n = 1) : (∃ n : ℕ, n > 0 ∧ g ^ n = 1) := by sorry
  ```

  Seemingly there's no one-line proof for this.

  Feedback: `#help tactic lift`

3. Workflow

  Collaboration need a fixed roadmap, but the best structure emerges only after some work.

  Plan: Write a human proof, rewrite it into steps, try to decouple it into independent lemmas.

  Code: Set up a roadmap, formalize the statements, then fill the sorrys.
  
  Adjust the structure accordingly during the process.
  
  May use a lot of `have`s to structure the proof in the beginning, but should pack them into `lemma`s when the time is right.

4. AI

  Currently, AI can't:

  - finish a proof directly
  - always suggest the right strategy

  But with good prompts, AI can:

  - provide potential code to work with, faster than start from scratch
  - help to find relevant Mathlib results (via its often-failing attempts to close the goal)
  - help to do rotine things, e.g. tidy up, produce docstrings and comments
  - help to structure the proof

5. On designing a comprehensive library

  - What lemmas should be proved? Which should be `@[simp, ext, norm_cast]`ed?
  - Class or proposition? Pack or unpack? Same condition, different forms.